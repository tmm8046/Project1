<!DOCTYPE html>
<html lang="en">
<head>
    <title></title>
    <link rel="stylesheet" href="../styles/styles.css"/>
    <script>
        const row = 5;
        const column = 5;

        //Pattern
        let pattern = '1, 2, 3, 4, 5, 6, 7, 8, 9, 10';

        const gridArray = new Array(row).fill(new Array(column));
        const guessButton = document.querySelector('#guessButton');
        const grid = document.querySelector("#grid");
        let guessNumber = 0;

        // Resets the pattern daily
        const reset = () => {
            let reset = new Date();

            reset.setHours(24, 0, 0, 0);

            let time = reset.getTime() - Date.now();
            setTimeout(function() {
                guessNumber = 1;
                reset();
            }, time);

        };

        const getJson = async () => {
            const url = "../json/patterns.json";

            fetch(url).then((response) => {
                return response.json();
            }).then(data => {
                console.log(data);
            }).catch(err => {

            })
        }

        const handleResponse = async () => {

            // let response = await fetch("../json/patterns.json", {
            //     headers: {
            //         'Accept': 'application/json'
            //     }
            // });
            
            // let obj = await response.json();

            let obj = getJson();
                
            let random = Math.floor(Math.random() * Object.keys(obj.patterns).length);
            let jsonString = JSON.stringify(obj.patterns[random]);
            console.log(jsonString);
            pattern = jsonString;
        }

        // Draws the grid
        const drawGrid = (row, column) => {
            for (let i = 0; i < row; i++) {
                for (let j = 0; j < column; j++) {
                    const gridBox = document.createElement('input');
                    gridBox.type = "text";
                    gridBox.class = 'tile';
                    gridBox.id = `tile${i}_${j}`;
                    if(i === 0) {
                        gridBox.disabled = false;
                    } else {
                        gridBox.disabled = true;
                    }
                    gridArray[i, j] = gridBox;
                    document.querySelector("#grid").appendChild(gridBox);
                }
                document.querySelector('#grid').innerHTML += "<br>";
            }
        };

        const checkAnswer = () => {
            const answer = pattern.split(',');
            let count = 0;

            //Loop through guesses to see if answers are correct
            for (let i = 0; i < answer.length / 2; i++) {
                const guess = document.querySelector(`#tile${guessNumber}_${i}`).value;

                if (parseInt(guess) === parseInt(answer[(answer.length / 2) + i])) {
                    document.querySelector(`#tile${guessNumber}_${i}`).style.background = "#33FFB2";
                    count++;
                } else if (includesParsed(answer, guess, answer.length / 2)){
                    document.querySelector(`#tile${guessNumber}_${i}`).style.background = "#FFED79";
                }
            }

            if (count === column){
                const answer = pattern.split(',');
                document.querySelector('#hint').innerHTML = '';
                for (let i = 0; i < answer.length; i++){
                    document.querySelector('#hint').innerHTML += `${answer[i]}`;
                    if(i < answer.length - 1){
                        document.querySelector('#hint').innerHTML += ', ';
                    }
                }
                document.querySelector("#answerStatus").innerHTML = "Congradulations!";
                return true;
            }
            return false;
        };

        //Searches array for a parsed value
        const includesParsed = (arr, value, length = 0) => {
            for (let i = 0; i < arr.length - length; i++) {
                if(parseInt(arr[length + i]) === parseInt(value)) {
                    return true;
                }
            }
            return false
        }

        const init = () => {
            handleResponse();
            console.log(pattern);
            reset();
            drawGrid(row, column);
            const answer = pattern.split(',');
            for (let i = 0; i < answer.length / 2; i++){
                document.querySelector('#hint').innerHTML += `${answer[i]}`;
                if(i < answer.length / 2 - 1){
                    document.querySelector('#hint').innerHTML += ', ';
                } else {
                    document.querySelector('#hint').innerHTML += '...';
                }
            }
            document.querySelector('#guessButton').addEventListener("click", () => {
                checkAnswer();
                for (let i = 0; i < row; i++) {
                    document.querySelector(`#tile${guessNumber}_${i}`).disabled = true;
                    if (guessNumber < column) {
                        document.querySelector(`#tile${guessNumber + 1}_${i}`).disabled = false;
                    }
                }
                guessNumber++;
            });
        };

        window.onload = init;
    </script>
</head>
<body>
    <div>
        <div id="hint">

        </div>
        <div id="answerStatus">

        </div>
        <div id="grid">
            
        </div>
        <div id="keyboard">
            <button id="guessButton">Guess</button>
        </div>
    </div>
</body>
</html>